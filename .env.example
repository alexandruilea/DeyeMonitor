# ========================================
# DEYE INVERTER CONFIGURATION
# ========================================
# Model: SUN-16K-SG05LP3-EU-SM2 (16kW Hybrid Inverter)
# Change these values to match your inverter model and network setup
DEYE_IP=192.168.0.xxx
DEYE_LOGGER_SERIAL=0000000000
DEYE_PORT=8899
DEYE_MODEL=SUN-16K-SG05LP3-EU-SM2

# Inverter-Specific Power Limits (Model: SUN-16K-SG05LP3-EU-SM2)
# Adjust these values if you have a different inverter model
DEYE_MAX_UPS_TOTAL_POWER=16000  # Maximum UPS/Backup port total output across all 3 phases (W)
DEYE_PHASE_MAX=7000             # Maximum safe power per phase (W) - prevents overload
DEYE_SAFETY_LV=185.0            # Critical low voltage threshold (V) - emergency shutdown
DEYE_MAX_CHARGE_AMPS_LIMIT=185  # Hardware maximum charging current limit (A) - model dependent

# Inverter-Specific Register Addresses (Model: SUN-16K-SG05LP3-EU-SM2)
# ⚠️ IMPORTANT: These register addresses are specific to the SUN-16K-SG05LP3-EU-SM2 model
# If you have a different Deye inverter model, you MUST update these addresses!
# Consult your inverter's Modbus register documentation

# Main register block (contains UPS loads, battery data, PV data)
DEYE_MAIN_BASE=588              # Base address for main register block
DEYE_MAIN_COUNT=90              # Number of registers to read from main block
DEYE_UPS_LOAD_L1_OFFSET=62      # Offset within main block for UPS L1 load (register 650)
DEYE_UPS_LOAD_L2_OFFSET=63      # Offset within main block for UPS L2 load (register 651)
DEYE_UPS_LOAD_L3_OFFSET=64      # Offset within main block for UPS L3 load (register 652)
DEYE_BATTERY_SOC_OFFSET=0       # Offset within main block for battery SOC% (register 588)
DEYE_BATTERY_VOLTAGE_OFFSET=36  # Offset within main block for battery voltage (register 624)

# Grid CT register block (contains grid loads from smart meter)
DEYE_GRID_CT_BASE=160           # Base address for grid CT register block
DEYE_GRID_CT_COUNT=35           # Number of registers to read from grid CT block
DEYE_GRID_LOAD_L1_OFFSET=19     # Offset within grid CT block for Grid L1 load (register 179)
DEYE_GRID_LOAD_L2_OFFSET=20     # Offset within grid CT block for Grid L2 load (register 180)
DEYE_GRID_LOAD_L3_OFFSET=21     # Offset within grid CT block for Grid L3 load (register 181)

# Inverter Write Control Registers (Model: SUN-16K-SG05LP3-EU-SM2)
# ⚠️ These register addresses may vary by inverter model - check your documentation!
DEYE_REG_MAX_CHARGE_AMPS=108        # Max charging current from any source (0-185A)
DEYE_REG_MAX_DISCHARGE_AMPS=109     # Max discharging current (0-185A)
DEYE_REG_GRID_CHARGE_ENABLE=130     # Enable grid charging (1=enable, 0=disable)
DEYE_REG_GRID_CHARGE_CURRENT=128    # Grid charge battery current (0-185A)
DEYE_REG_SOLAR_SELL_SLOT1=145       # Solar sell for time slot 1 (1=enable, 0=disable)
DEYE_REG_GRID_CHARGE_SLOT1=172      # Grid charge for time slot 1 (1=enable, 0=disable)
DEYE_REG_CHARGE_TARGET_SOC=166      # Target SOC for charging (%)
DEYE_REG_MAX_GRID_POWER=143         # Limit max grid power output (0-8000W)
DEYE_REG_MAX_SOLAR_SELL_POWER=340   # Max solar sell power (W)

# ========================================
# OVERPOWER PROTECTION SETTINGS
# ========================================
# Automatically increases charging to absorb excess power when:
# - Export power approaches the max sell power limit
# - Phase voltage exceeds the warning threshold
# This helps prevent inverter shutdown due to grid overvoltage or power limits.

PROTECTION_MAX_SELL_POWER=8000               # Max export power limit in Watts (updated from inverter at startup)
PROTECTION_POWER_THRESHOLD_PCT=95            # Start protection when export exceeds this % of max
PROTECTION_RECOVERY_THRESHOLD_PCT=85         # Reduce protection when export drops below this %
PROTECTION_VOLTAGE_WARNING=251.5             # Start protection when any phase voltage exceeds this (V)
PROTECTION_VOLTAGE_RECOVERY=249.0            # Reduce protection when voltage drops below this (V)
PROTECTION_CHARGE_STEP=10                    # Increase charging by this many Amps per step
PROTECTION_ADJUSTMENT_INTERVAL=10            # Seconds between charge adjustments (allows system to stabilize)

# ========================================
# TAPO SMART PLUG OUTLETS
# ========================================
# Format: OUTLET_<N>_<PROPERTY> where N is the outlet number
# 
# PARAMETER EXPLANATIONS:
# 
# IP               - IP address of the Tapo P110 smart outlet on your network
# USER             - Tapo account email (must be OWNER account, not shared device)
# PASS             - Tapo account password
# NAME             - Display name shown in the UI
# PRIORITY         - Cascade priority (1=highest, turns on first. 2,3,etc turn on after higher priorities)
# POWER            - Estimated power consumption in Watts (DISPLAY ONLY - not used in startup logic)
# 
# START_SOC        - Battery % threshold: Turn ON when battery reaches this level (if other conditions met)
# STOP_SOC         - Battery % threshold: Turn OFF when battery drops below this level
# 
# HV_THRESHOLD     - High Voltage dump: Turn ON when monitored phase voltage reaches this level
# LV_THRESHOLD     - Low Voltage protection: Turn OFF when phase voltage drops below this level
# LV_DELAY         - Seconds to wait before turning OFF due to low voltage (prevents brief dips)
# 
# HEADROOM         - Minimum available power (Watts) needed to start this outlet
#                    System checks: (Max Phase Power - Current Load) >= HEADROOM before turning ON
#                    Example: Max=7000W, Current=500W, Headroom=1000W → Available=6500W ✓ Can start
# 
# TARGET_PHASE     - Which phase to monitor for voltage (L1, L2, or L3)
# 
# EXPORT_ACTIVE    - Enable/disable grid export dump feature (true/false)
# EXPORT_LIMIT     - Turn ON when grid export exceeds this many Watts (dumps excess solar to outlet)
# 
# RUNTIME_DELAY    - For priority 2+: Seconds higher priority outlets must run BEFORE this one can start
#                    Example: Priority 2 with RUNTIME_DELAY=300 waits 5 minutes after Priority 1 starts
#                    Priority 1 outlets ignore this parameter

# ===== OUTLET 1 - HEAT PUMP (HIGHEST PRIORITY) =====
OUTLET_1_IP=192.168.0.xxx
OUTLET_1_USER=your_email@example.com
OUTLET_1_PASS=your_password
OUTLET_1_NAME=Heat Pump
OUTLET_1_PRIORITY=1
OUTLET_1_POWER=3000

# SOC (State of Charge) Thresholds - Battery percentage triggers
OUTLET_1_START_SOC=70
OUTLET_1_STOP_SOC=32

# Voltage Thresholds - Phase voltage triggers
OUTLET_1_HV_THRESHOLD=252.0
OUTLET_1_LV_THRESHOLD=210.0
OUTLET_1_LV_DELAY=10

# Power Management
OUTLET_1_HEADROOM=1000
OUTLET_1_TARGET_PHASE=L1

# Trigger Enable/Disable - Control which conditions can turn the outlet ON
OUTLET_1_SOC_ENABLED=true                    # Enable SOC-based trigger (uses START_SOC threshold)
OUTLET_1_VOLTAGE_ENABLED=true                # Enable voltage-based trigger (uses HV_THRESHOLD for ON, LV_THRESHOLD for OFF)
OUTLET_1_EXPORT_ENABLED=true                 # Enable export-based trigger (uses EXPORT_LIMIT threshold)

# Export Control - Grid export triggers (only used if EXPORT_ENABLED=true)
OUTLET_1_EXPORT_LIMIT=5000

# Cascade Delay (only affects priority 2+ outlets)
OUTLET_1_RUNTIME_DELAY=300

# ===== OUTLET 2 - EXTRA LOAD (SECOND PRIORITY) =====
# Uncomment these lines if you have a second outlet
#OUTLET_2_IP=192.168.0.xxx
#OUTLET_2_USER=your_email@example.com
#OUTLET_2_PASS=your_password
#OUTLET_2_NAME=Extra Load
#OUTLET_2_PRIORITY=2
#OUTLET_2_POWER=2000
#
## SOC Thresholds
#OUTLET_2_START_SOC=65
#OUTLET_2_STOP_SOC=35
#
## Voltage Thresholds
#OUTLET_2_HV_THRESHOLD=252.0
#OUTLET_2_LV_THRESHOLD=210.0
#OUTLET_2_LV_DELAY=10
#
## Power Management
#OUTLET_2_HEADROOM=3000
#OUTLET_2_TARGET_PHASE=L1
#
## Trigger Enable/Disable - Control which conditions can turn the outlet ON
#OUTLET_2_SOC_ENABLED=true                    # Enable SOC-based trigger (uses START_SOC threshold)
#OUTLET_2_VOLTAGE_ENABLED=true                # Enable voltage-based trigger (uses HV_THRESHOLD for ON, LV_THRESHOLD for OFF)
#OUTLET_2_EXPORT_ENABLED=true                 # Enable export-based trigger (uses EXPORT_LIMIT threshold)
#
## Export Control - Grid export triggers (only used if EXPORT_ENABLED=true)
#OUTLET_2_EXPORT_LIMIT=3000
#
## Cascade Delay - IMPORTANT: Priority 2 waits for Priority 1 to run first
#OUTLET_2_RUNTIME_DELAY=300                   # Seconds Priority 1 must run BEFORE this outlet can start (300s = 5 minutes)

# ========================================
# PARAMETER EXPLANATIONS
# ========================================
#
# IP               - IP address of the Tapo P110 smart outlet on your network
# USER             - Tapo account email (must be OWNER account, not shared device)
# PASS             - Tapo account password
# NAME             - Display name shown in the UI
# PRIORITY         - Cascade priority (1=highest, turns on first. 2,3,etc turn on after higher priorities)
# POWER            - Estimated power consumption in Watts (DISPLAY ONLY - not used in startup logic)
# 
# START_SOC        - Battery % threshold: Turn ON when battery reaches this level (if SOC_ENABLED=true)
# STOP_SOC         - Battery % threshold: Turn OFF when battery drops below this level
# 
# HV_THRESHOLD     - High Voltage dump: Turn ON when monitored phase voltage reaches this level (if VOLTAGE_ENABLED=true)
# LV_THRESHOLD     - Low Voltage protection: Turn OFF when phase voltage drops below this level
# LV_DELAY         - Seconds to wait before turning OFF due to low voltage (prevents brief dips)
# 
# HEADROOM         - Minimum available power (Watts) needed to start this outlet
#                    System checks: (Max Phase Power - Current Load) >= HEADROOM before turning ON
#                    Example: Max=7000W, Current=500W, Headroom=1000W → Available=6500W ✓ Can start
# 
# TARGET_PHASE     - Which phase to monitor for voltage (L1, L2, or L3)
# 
# SOC_ENABLED      - Enable/disable SOC-based trigger (true/false)
# VOLTAGE_ENABLED  - Enable/disable voltage-based trigger (true/false)
# EXPORT_ENABLED   - Enable/disable grid export dump feature (true/false)
# 
# EXPORT_LIMIT     - Turn ON when grid export exceeds this many Watts (only if EXPORT_ENABLED=true)
# 
# RUNTIME_DELAY    - For priority 2+: Seconds higher priority outlets must run BEFORE this one can start
#                    Example: Priority 2 with RUNTIME_DELAY=300 waits 5 minutes after Priority 1 starts
#                    Priority 1 outlets ignore this parameter
